<!-- Main content -->
<div class="content-wrapper">

	<!-- Content area -->
	<div class="content">
		<div class="container">
			
			<div class="row">
				<div class="col-lg-6 pull-left">
					<h6 class="panel-title">Reporting</h6>
				</div>
				<div class="col-lg-6 pull-right text-right">
					<!-- Group by -->
					<div class="btn-group btn-group-animated">
		                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
		                	Group by <span class="caret"></span>
		                </button>
						<ul class="dropdown-menu">
							<li>
								<a href="./index.php/report/host">
									<i class="icon-menu7"></i> Host
								</a>
							</li>
							<li>
								<a href="./index.php/report/malware">
									<i class="icon-screen-full"></i> Malware
								</a>
							</li>
						</ul>
		            </div>

					<!-- Group by -->
					<div class="btn-group btn-group-animated">
		                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
		                	Duration <span class="caret"></span>
		                </button>
						<ul class="dropdown-menu">
							<li>
								<a href="./index.php/report/weekly">
									<i class="icon-screen-full"></i> Weekly(host)
								</a>
							</li>
							<li>
								<a href="./index.php/report/monthly">
									<i class="icon-menu7"></i> Monthly(host)
								</a>
							</li>
							<li>
								<a href="./index.php/report/yearly">
									<i class="icon-menu7"></i> Yearly(host)
								</a>
							</li>
							<li>
								<a href="./index.php/report/weekly/malware">
									<i class="icon-screen-full"></i> Weekly(malware)
								</a>
							</li>
							<li>
								<a href="./index.php/report/monthly/malware">
									<i class="icon-menu7"></i> Monthly(malware)
								</a>
							</li>
							<li>
								<a href="./index.php/report/yearly/malware">
									<i class="icon-menu7"></i> Yearly(malware)
								</a>
							</li>
						</ul>
		            </div>

		            <!-- Convert HTML -->
		            <!-- <button type="button" class="btn btn-primary btn-ladda btn-ladda-progress" data-style="zoom-in">
		            	<span class="ladda-label">Convert to HTML</span>
		            </button> -->

		            <!-- Convert PDF -->
		            <button type="button" id="save_as_pdf" class="btn btn-primary btn-ladda btn-ladda-progress" data-style="zoom-in">
		            	<span class="ladda-label">Convert to PDF</span>
		            </button>
				</div>
			</div>
		</div>
		<div class="container" id="pdf_content">
			<br>
			<div class="row well">
                <div class="table-responsive" id="my-table">
					<table class="table datatable-columns table-striped">
						<thead>
							<tr>
								<th colspan="2" class="text-center">Malware listing</th>
							</tr>
						</thead>
						<tbody>
							<?php for($i = 0; $i < count($mfs); $i+=2) {?>
								<tr style="cursor: pointer;">
									<td><?php echo isset($mfs[$i]) ? $mfs[$i] : ""; ?></td>
									<td><?php echo isset($mfs[$i+1]) ? $mfs[$i+1] : ""; ?></td>
								</tr>
							<?php } ?>
						</tbody>
					</table>
				</div>
			</div>
			<br>
			<div class="row">
				<div class="panel panel-success">
					<div class="panel-heading">
						<h3 class="panel-title"><?php echo $mf['name']; ?></h3>
					</div>
					<div class="panel-body">
						<div class="table-responsive" id="my-table">
							<div class="mal_info">
								<p>Name: <?php echo $mf['name'];?></p>
								<p>References: <?php echo implode(", ", $mf['references']);?></p>
								<p>Tags: <?php echo implode(", ", $mf['tags']);?></p>
								<p>Groups: <?php echo isset($mf['in_group']) ? $mf['in_group'] : "";?></p>
								<p>Industries: <?php echo implode(", ", $mf['industries']);?></p>
								<p>Targeted Countries: <?php echo implode(", ", $mf['targeted_countries']);?></p>
								<p>Description: <?php echo $mf['description'];?></p>
							</div>

							<table class="table datatable-columns table-striped">
								<thead>
									<tr>
										<th>Name</th>
										<th>Events</th>
										<th>Fisrt</th>
										<th>Last</th>
										<th>Impact</th>
									</tr>
								</thead>
								<tbody>
									<?php $incidents = $this->mongo_db->where(array('rule' => $mf['id']))->get('incidents');
									foreach ($incidents as $inc) {
										$name = '';
										$impact = 100;
										if (isset($mf['impact'])) {
											$impact = $mf['impact'];
										}
										$label_class = "label-";
										if ($impact < 40) {
											$label_class .= "success";
										}
										elseif($impact < 60){
											$label_class .= "info";
										}
										elseif($impact < 80){
											$label_class .= "warning";
										}else{
											$label_class .= "danger";
										}
										?>
										<tr>
											<td><?php echo $name;?></td>
											<td><?php echo $inc['count'];?></td>
											<td><?php echo @date("Y-m-d H:i", $inc['firstseen']->sec);?></td>
											<td><?php echo @date("Y-m-d H:i", $inc['lastseen']->sec);?></td>
											<td>
												<h4>
													<span class="label <?php echo $label_class; ?>">
														<?php echo $impact;?>
													</span>
												</h4>
											</td>
										</tr>
									<?php } ?>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(function() {
	    // Setting datatable defaults
	    $.extend( $.fn.dataTable.defaults, {
	        autoWidth: false,
	        columnDefs: [{ 
	            orderable: false,
	            width: '100px',
	            targets: [ 5 ]
	        }],
	        dom: '<"datatable-header"fl><"datatable-scroll"t><"datatable-footer"ip>',
	        language: {
	            search: '<span>Filter:</span> _INPUT_',
	            lengthMenu: '<span>Show:</span> _MENU_',
	            paginate: { 'first': 'First', 'last': 'Last', 'next': '&rarr;', 'previous': '&larr;' }
	        },
	        drawCallback: function () {
	            $(this).find('tbody tr').slice(-3).find('.dropdown, .btn-group').addClass('dropup');
	        },
	        preDrawCallback: function() {
	            $(this).find('tbody tr').slice(-3).find('.dropdown, .btn-group').removeClass('dropup');
	        }
	    });
	    
	    // Columns rendering
	    $('.datatable-columns').dataTable({
	    	"order": [
	            [1, "desc"]
	        ],
	        pageLength: 10
	    });
	    // External table additions
	    // ------------------------------

	    // Add placeholder to the datatable filter option
	    $('.dataTables_filter input[type=search]').attr('placeholder','Type to filter...');


	    // Enable Select2 select for the length option
	    $('.dataTables_length select').select2({
	        minimumResultsForSearch: Infinity,
	        width: 'auto'
	    });
		});
</script>
