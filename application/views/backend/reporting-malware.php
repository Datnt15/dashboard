<!-- Content area -->
<div class="content">
	<div class="container">
		
		<div class="row">
			<div class="col-lg-6 pull-left">
				<h1 class="panel-title">Reporting</h1>
			</div>
			<div class="col-lg-6 pull-right text-right">
				<!-- Group by -->
				<div class="btn-group btn-group-animated">
	                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
	                	Group by <span class="caret"></span>
	                </button>
					<ul class="dropdown-menu">
						<li>
							<a href="./index.php/report/host">
								<i class="icon-menu7"></i> Host
							</a>
						</li>
						<li>
							<a href="./index.php/report/malware">
								<i class="icon-screen-full"></i> Malware
							</a>
						</li>
					</ul>
	            </div>

				<!-- Group by -->
				<div class="btn-group btn-group-animated">
	                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
	                	Duration <span class="caret"></span>
	                </button>
					<ul class="dropdown-menu">
						<li>
							<a href="./index.php/report/weekly">
								<i class="icon-screen-full"></i> Weekly(host)
							</a>
						</li>
						<li>
							<a href="./index.php/report/monthly">
								<i class="icon-menu7"></i> Monthly(host)
							</a>
						</li>
						<li>
							<a href="./index.php/report/yearly">
								<i class="icon-menu7"></i> Yearly(host)
							</a>
						</li>
						<li>
							<a href="./index.php/report/weekly/malware">
								<i class="icon-screen-full"></i> Weekly(malware)
							</a>
						</li>
						<li>
							<a href="./index.php/report/monthly/malware">
								<i class="icon-menu7"></i> Monthly(malware)
							</a>
						</li>
						<li>
							<a href="./index.php/report/yearly/malware">
								<i class="icon-menu7"></i> Yearly(malware)
							</a>
						</li>
					</ul>
	            </div>

	            <!-- Convert HTML -->
	            <!-- <button type="button" class="btn btn-primary btn-ladda btn-ladda-progress" data-style="zoom-in">
	            	<span class="ladda-label">Convert to HTML</span>
	            </button> -->

	            <!-- Convert PDF -->
	            <button type="button" id="save_as_pdf" class="btn btn-primary btn-ladda btn-ladda-progress" data-style="zoom-in">
	            	<span class="ladda-label">Convert to PDF</span>
	            </button>
			</div>
		</div>
	</div>
	<div class="container" id="pdf_content">
		<br>
		<div class="row well">
            <div class="table-responsive" id="my-table">
				<table class="table datatable-columns table-striped table-hover datatable-basic dataTable">
					<thead>
						<tr>
							<th>Malware listing</th>
							<th>Malware listing</th>
						</tr>
					</thead>
					<tbody>
						<?php for($i = 0; $i < count($mfs); $i+=2) {?>
							<tr>
								<td class="mf_title"><?php echo isset($mfs[$i]) ? $mfs[$i] : ""; ?></td>
								<td class="mf_title"><?php echo isset($mfs[$i+1]) ? $mfs[$i+1] : ""; ?></td>
							</tr>
						<?php } ?>
					</tbody>
				</table>
			</div>
		</div>
		<br>
		<div class="row">
		<?php foreach ($all_mf_info as $mf): ?>
			<div class="panel">
				<div class="panel-heading navbar-inverse">
					<h3 class="panel-title"><?php echo $mf['name']; ?></h3>
				</div>
				<div class="panel-body">
					<div class="table-responsive">
						<div class="mal_info">
							<p><strong>Name</strong>: <?php echo $mf['name'];?></p>
							<p><strong>References</strong>: <?php echo implode(", ", $mf['references']);?></p>
							<p><strong>Tags</strong>: <?php echo implode(", ", $mf['tags']);?></p>
							<p><strong>Groups</strong>: <?php echo isset($mf['in_group']) ? $mf['in_group'] : "";?></p>
							<p><strong>Industries</strong>: <?php echo implode(", ", $mf['industries']);?></p>
							<p><strong>Targeted Countries</strong>: <?php echo implode(", ", $mf['targeted_countries']);?></p>
							<p><strong>Description</strong>: <?php echo $mf['description'];?></p>
						</div>
						<?php $incidents = $this->mongo_db->where(array('rule' => $mf['id']))->get('incidents'); ?>
						<?php if (count($incidents)): ?>
							<h4>All incidents:</h4>
							<table class="table table-striped table-hover datatable-basic">
								<thead>
									<tr>
										<th>Name</th>
										<th>Events</th>
										<th>Fisrt</th>
										<th>Last</th>
										<th>Impact</th>
									</tr>
								</thead>
								<tbody>
									<?php foreach ($incidents as $inc) {
										$name = '';
										$impact = 100;
										if (isset($mf['impact'])) {
											$impact = $mf['impact'];
										}
										$label_class = "label-";
										if ($impact < 40) {
											$label_class .= "success";
										}
										elseif($impact < 60){
											$label_class .= "info";
										}
										elseif($impact < 80){
											$label_class .= "warning";
										}else{
											$label_class .= "danger";
										}
										?>
										<tr>
											<td><?php echo $name;?></td>
											<td><?php echo $inc['count'];?></td>
											<td><?php echo @date("Y-m-d H:i", $inc['firstseen']->sec);?></td>
											<td><?php echo @date("Y-m-d H:i", $inc['lastseen']->sec);?></td>
											<td>
												<h4>
													<span class="label <?php echo $label_class; ?>">
														<?php echo $impact;?>
													</span>
												</h4>
											</td>
										</tr>
									<?php } ?>
								</tbody>
							</table>
						<?php endif ?>
					</div>
				</div>
			</div>
		<?php endforeach ?>
		</div>
	</div>
</div>


<script type="text/javascript">
	$(function() {
	    jQuery(document).ready(function($) {
	    	$(".mf_title").click(function() {
	    		var text = $(this).text();
	    		$('html, body').animate({
			        scrollTop: $(".panel > .panel-heading.navbar-inverse > .panel-title:contains('" + text + "')").offset().top - 20
			    }, 2000);
	    	});
	    });
	    // Columns rendering
	    // $('.datatable-columns').dataTable();
	});
</script>
